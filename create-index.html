<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»º Firestore ç´¢å¼• - Team Note Pro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .link-button {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .link-button:hover {
            background: #0056b3;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ åˆ›å»º Firestore æ•°æ®åº“ç´¢å¼•</h1>

        <div class="warning">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong> æ‚¨çš„åº”ç”¨éœ€è¦åˆ›å»ºä¸€ä¸ª Firestore ç´¢å¼•æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚è¿™ä¸ªè¿‡ç¨‹åªéœ€è¦ä¸€æ¬¡ã€‚
        </div>

        <h2>ğŸ“‹ é—®é¢˜è¯´æ˜</h2>
        <p>æ‚¨çš„ç¬”è®°åº”ç”¨éœ€è¦æŒ‰ç”¨æˆ·IDå’Œæ›´æ–°æ—¶é—´æ’åºæŸ¥è¯¢ç¬”è®°ã€‚Firestore éœ€è¦ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªå¤åˆç´¢å¼•ã€‚</p>

        <h2>ğŸš€ è§£å†³æ–¹æ¡ˆ</h2>

        <div class="step">
            <h3>æ–¹æ³•ä¸€ï¼šè‡ªåŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼ŒFirebase ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºåˆ›å»ºæ‰€éœ€çš„ç´¢å¼•ï¼š</p>

            <a href="https://console.firebase.google.com/v1/r/project/team-note-pro/firestore/indexes?create_composite=Cktwcm9qZWN0cy90ZWFtLW5vdGUtcHJvL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9ub3Rlcy9pbmRleGVzL18QARoHCgN1aWQQARoNCgl1cGRhdGVkQXQQAhoMCghfX25hbWVfXxAC"
               target="_blank"
               class="link-button">
                ğŸ“± è‡ªåŠ¨åˆ›å»º Firestore ç´¢å¼•
            </a>

            <p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
            <ol>
                <li>ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®æ‰“å¼€ Firebase æ§åˆ¶å°</li>
                <li>ç™»å½•æ‚¨çš„ Google è´¦å·ï¼ˆå¦‚æœéœ€è¦ï¼‰</li>
                <li>ç¡®è®¤é¡¹ç›®æ˜¯ "team-note-pro"</li>
                <li>ç‚¹å‡»"åˆ›å»ºç´¢å¼•"æŒ‰é’®</li>
                <li>ç­‰å¾…ç´¢å¼•åˆ›å»ºå®Œæˆï¼ˆé€šå¸¸éœ€è¦å‡ åˆ†é’Ÿï¼‰</li>
            </ol>
        </div>

        <div class="step">
            <h3>æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º</h3>
            <p>å¦‚æœä¸Šé¢çš„é“¾æ¥ä¸å·¥ä½œï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨åˆ›å»ºç´¢å¼•ï¼š</p>

            <ol>
                <li>è®¿é—® <a href="https://console.firebase.google.com/project/team-note-pro/firestore" target="_blank">Firebase æ§åˆ¶å°</a></li>
                <li>é€‰æ‹© "team-note-pro" é¡¹ç›®</li>
                <li>è¿›å…¥ Firestore æ•°æ®åº“</li>
                <li>ç‚¹å‡» "ç´¢å¼•" æ ‡ç­¾é¡µ</li>
                <li>ç‚¹å‡»"æ·»åŠ ç´¢å¼•"æŒ‰é’®</li>
                <li>å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š</li>
            </ol>

            <div class="code">
                <strong>é›†åˆIDï¼š</strong> notes<br>
                <strong>å­—æ®µï¼š</strong><br>
                - uid (å‡åº)<br>
                - updatedAt (é™åº)<br>
                <strong>æŸ¥è¯¢èŒƒå›´ï¼š</strong> é›†åˆ<br>
                <strong>ç´¢å¼•åç§°ï¼š</strong> notes_uid_updatedAt (è‡ªåŠ¨ç”Ÿæˆ)
            </div>
        </div>

        <div class="step">
            <h3>âœ… éªŒè¯ç´¢å¼•åˆ›å»º</h3>
            <p>åˆ›å»ºç´¢å¼•åï¼Œè¿”å›æ‚¨çš„åº”ç”¨å¹¶åˆ·æ–°é¡µé¢ã€‚åº”ç”¨åº”è¯¥èƒ½æ­£å¸¸åŠ è½½ç¬”è®°åˆ—è¡¨äº†ã€‚</p>

            <p>æ‚¨ä¹Ÿå¯ä»¥è®¿é—®æµ‹è¯•é¡µé¢éªŒè¯ï¼š</p>
            <a href="/simple-app.html" class="link-button">ğŸ“ æ‰“å¼€ç®€åŒ–ç‰ˆåº”ç”¨</a>
        </div>

        <div class="success">
            <strong>ğŸ’¡ æç¤ºï¼š</strong> ç´¢å¼•åˆ›å»ºæ˜¯ä¸€æ¬¡æ€§æ“ä½œã€‚åˆ›å»ºå®Œæˆåï¼Œæ‚¨çš„åº”ç”¨å°±èƒ½æ­£å¸¸å·¥ä½œäº†ï¼Œæ— éœ€é‡å¤æ­¤æ­¥éª¤ã€‚
        </div>

        <h2>ğŸ” æ•…éšœæ’é™¤</h2>

        <div class="step">
            <h3>å¦‚æœä»æœ‰é—®é¢˜ï¼š</h3>
            <ol>
                <li>ç­‰å¾…å‡ åˆ†é’Ÿè®©ç´¢å¼•å®Œå…¨ç”Ÿæ•ˆ</li>
                <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢</li>
                <li>æ£€æŸ¥æ‚¨æ˜¯å¦æœ‰è¶³å¤Ÿçš„ Firebase æƒé™</li>
                <li>ç¡®è®¤é€‰æ‹©äº†æ­£ç¡®çš„é¡¹ç›®ï¼ˆteam-note-proï¼‰</li>
                <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯</li>
            </ol>
        </div>

        <div class="step">
            <h3>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š</h3>
            <p>å¦‚æœæ— æ³•ç«‹å³åˆ›å»ºç´¢å¼•ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨ä½¿ç”¨å®¢æˆ·ç«¯æ’åºä½œä¸ºä¸´æ—¶è§£å†³æ–¹æ¡ˆã€‚è¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†åŠŸèƒ½ä»ç„¶å¯ç”¨ã€‚</p>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç´¢å¼•çŠ¶æ€
        async function checkIndexStatus() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyCiUK6B4HCSHD3jGpcfRwbd81RxEtCO-l4",
                    authDomain: "team-note-pro.firebaseapp.com",
                    projectId: "team-note-pro",
                    storageBucket: "team-note-pro.appspot.com",
                    messagingSenderId: "475394331627",
                    appId: "1:475394331627:web:placeholder_app_id"
                };

                firebase.initializeApp(firebaseConfig);
                const db = firebase.firestore();

                // å°è¯•æŸ¥è¯¢æ¥æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨
                try {
                    await db
                        .collection('notes')
                        .where('uid', '==', 'test')
                        .orderBy('updatedAt', 'desc')
                        .limit(1)
                        .get();

                    document.querySelector('.success').innerHTML +=
                        '<p><strong>âœ… ç´¢å¼•æ£€æŸ¥ï¼š</strong> ç´¢å¼•å·²å­˜åœ¨ï¼Œåº”ç”¨åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œï¼</p>';
                } catch (error) {
                    if (error.message.includes('requires an index')) {
                        document.querySelector('.warning').innerHTML +=
                            '<p><strong>âŒ ç´¢å¼•æ£€æŸ¥ï¼š</strong> ç´¢å¼•å°šæœªåˆ›å»ºï¼Œè¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤åˆ›å»ºã€‚</p>';
                    }
                }
            } catch (error) {
                console.log('æ— æ³•æ£€æŸ¥ç´¢å¼•çŠ¶æ€:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥ç´¢å¼•çŠ¶æ€
        window.addEventListener('load', checkIndexStatus);
    </script>

    <!-- Firebase SDK for index checking -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</body>
</html>