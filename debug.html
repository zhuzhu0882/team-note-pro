<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - Team Note Pro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            min-height: 50px;
        }
        button:hover {
            background: #0056b3;
        }
        button:active {
            transform: scale(0.98);
        }
        #debug-log {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Team Note Pro è°ƒè¯•é¡µé¢</h1>

    <div class="test-section">
        <h2>ğŸ“‹ ç³»ç»Ÿä¿¡æ¯</h2>
        <div id="system-info"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”— Firebase è¿æ¥æµ‹è¯•</h2>
        <button onclick="testFirebaseConnection()">æµ‹è¯• Firebase è¿æ¥</button>
        <button onclick="testFirebaseAuth()">æµ‹è¯•ç”¨æˆ·è®¤è¯</button>
        <button onclick="testFirebaseDB()">æµ‹è¯•æ•°æ®åº“</button>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æŒ‰é’®åŠŸèƒ½æµ‹è¯•</h2>
        <button id="test-new-note" onclick="testNewNote()">ğŸ“ æµ‹è¯•æ–°å»ºç¬”è®°</button>
        <button id="test-save" onclick="testSave()">ğŸ’¾ æµ‹è¯•ä¿å­˜</button>
        <button id="test-delete" onclick="testDelete()">ğŸ—‘ï¸ æµ‹è¯•åˆ é™¤</button>
        <button onclick="testDOMEvents()">ğŸ¯ æµ‹è¯•DOMäº‹ä»¶</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“± ç§»åŠ¨ç«¯æµ‹è¯•</h2>
        <button onclick="testMobileFeatures()">æµ‹è¯•ç§»åŠ¨ç«¯ç‰¹æ€§</button>
        <button onclick="testTouchEvents()">æµ‹è¯•è§¦æ‘¸äº‹ä»¶</button>
        <button onclick="testViewport()">æµ‹è¯•è§†å£</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“„ å®æ—¶æ—¥å¿—</h2>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <div id="debug-log"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `debug-result ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }

        // ç³»ç»Ÿä¿¡æ¯
        function showSystemInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screen: `${screen.width}x${screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                touchSupport: 'ontouchstart' in window,
                mobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
            };

            const infoDiv = document.getElementById('system-info');
            infoDiv.innerHTML = Object.entries(info).map(([key, value]) =>
                `<div><strong>${key}:</strong> ${value}</div>`
            ).join('');

            log(`ç³»ç»Ÿä¿¡æ¯: ${JSON.stringify(info, null, 2)}`, 'info');
        }

        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCiUK6B4HCSHD3jGpcfRwbd81RxEtCO-l4",
            authDomain: "team-note-pro.firebaseapp.com",
            projectId: "team-note-pro",
            storageBucket: "team-note-pro.appspot.com",
            messagingSenderId: "475394331627",
            appId: "1:475394331627:web:placeholder_app_id"
        };

        // æµ‹è¯• Firebase è¿æ¥
        function testFirebaseConnection() {
            try {
                log('å¼€å§‹æµ‹è¯• Firebase è¿æ¥...', 'info');

                // æ£€æŸ¥ Firebase SDK
                if (typeof firebase === 'undefined') {
                    log('âŒ Firebase SDK æœªåŠ è½½', 'error');
                    return;
                }

                // åˆå§‹åŒ– Firebase
                firebase.initializeApp(firebaseConfig);
                log('âœ… Firebase åˆå§‹åŒ–æˆåŠŸ', 'success');

                const auth = firebase.auth();
                const db = firebase.firestore();

                log(`âœ… Auth æœåŠ¡: ${typeof auth}`, 'success');
                log(`âœ… Firestore æœåŠ¡: ${typeof db}`, 'success');
                log(`âœ… é¡¹ç›®ID: ${firebase.app().options.projectId}`, 'success');

                // æµ‹è¯•æ•°æ®åº“è¿æ¥
                db.collection('test').doc('debug').set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    test: 'debug-test'
                }).then(() => {
                    log('âœ… Firestore å†™å…¥æµ‹è¯•æˆåŠŸ', 'success');
                    return db.collection('test').doc('debug').get();
                }).then((doc) => {
                    if (doc.exists) {
                        log(`âœ… Firestore è¯»å–æµ‹è¯•æˆåŠŸ: ${JSON.stringify(doc.data())}`, 'success');
                        return db.collection('test').doc('debug').delete();
                    }
                }).then(() => {
                    log('âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ', 'success');
                }).catch((error) => {
                    log(`âŒ Firestore æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                });

            } catch (error) {
                log(`âŒ Firebase è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç”¨æˆ·è®¤è¯
        function testFirebaseAuth() {
            try {
                log('å¼€å§‹æµ‹è¯•ç”¨æˆ·è®¤è¯...', 'info');

                const auth = firebase.auth();
                const user = auth.currentUser;

                if (user) {
                    log(`âœ… ç”¨æˆ·å·²ç™»å½•: ${user.email}`, 'success');
                } else {
                    log('â„¹ï¸ å½“å‰æœªç™»å½•', 'info');
                }

                // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        log(`âœ… è®¤è¯çŠ¶æ€å˜åŒ– - ç”¨æˆ·å·²ç™»å½•: ${user.email}`, 'success');
                    } else {
                        log('â„¹ï¸ è®¤è¯çŠ¶æ€å˜åŒ– - ç”¨æˆ·æœªç™»å½•', 'info');
                    }
                });

                log('âœ… ç”¨æˆ·è®¤è¯åŠŸèƒ½æ­£å¸¸', 'success');

            } catch (error) {
                log(`âŒ ç”¨æˆ·è®¤è¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ•°æ®åº“
        function testFirebaseDB() {
            try {
                log('å¼€å§‹æµ‹è¯•æ•°æ®åº“åŠŸèƒ½...', 'info');

                const db = firebase.firestore();

                // æµ‹è¯•åˆ›å»ºç¬”è®°
                const testNote = {
                    title: 'æµ‹è¯•ç¬”è®°',
                    content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¬”è®°å†…å®¹',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                db.collection('notes').add(testNote).then((docRef) => {
                    log(`âœ… åˆ›å»ºç¬”è®°æˆåŠŸ: ${docRef.id}`, 'success');

                    // æµ‹è¯•è¯»å–ç¬”è®°
                    return db.collection('notes').doc(docRef.id).get();
                }).then((doc) => {
                    if (doc.exists) {
                        log(`âœ… è¯»å–ç¬”è®°æˆåŠŸ: ${JSON.stringify(doc.data())}`, 'success');

                        // æµ‹è¯•æ›´æ–°ç¬”è®°
                        return db.collection('notes').doc(doc.id).update({
                            content: 'æ›´æ–°åçš„ç¬”è®°å†…å®¹',
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }).then(() => {
                    log('âœ… æ›´æ–°ç¬”è®°æˆåŠŸ', 'success');

                    // æµ‹è¯•åˆ é™¤ç¬”è®°
                    return db.collection('notes').doc(doc.id).delete();
                }).then(() => {
                    log('âœ… åˆ é™¤ç¬”è®°æˆåŠŸ', 'success');
                    log('âœ… æ•°æ®åº“æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡', 'success');
                }).catch((error) => {
                    log(`âŒ æ•°æ®åº“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                });

            } catch (error) {
                log(`âŒ æ•°æ®åº“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ–°å»ºç¬”è®°
        function testNewNote() {
            log('ğŸ“ æµ‹è¯•æ–°å»ºç¬”è®°åŠŸèƒ½...', 'info');

            // æ¨¡æ‹Ÿæ–°å»ºç¬”è®°çš„ç‚¹å‡»äº‹ä»¶
            const button = document.getElementById('test-new-note');

            try {
                // æ£€æŸ¥æŒ‰é’®æ˜¯å¦æ­£ç¡®ç»‘å®šäº‹ä»¶
                if (button.onclick) {
                    log('âœ… æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ', 'success');

                    // æ¨¡æ‹Ÿåˆ›å»ºç¬”è®°çš„é€»è¾‘
                    const newNote = {
                        id: 'test_' + Date.now(),
                        title: 'æµ‹è¯•ç¬”è®° ' + new Date().toLocaleTimeString(),
                        content: 'è¿™æ˜¯æµ‹è¯•åˆ›å»ºçš„ç¬”è®°å†…å®¹',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };

                    log(`âœ… æ¨¡æ‹Ÿåˆ›å»ºç¬”è®°: ${JSON.stringify(newNote, null, 2)}`, 'success');

                    // å¦‚æœå­˜åœ¨å…¨å±€ noteAppï¼Œå°è¯•ä½¿ç”¨å®ƒçš„æ–¹æ³•
                    if (window.noteApp && window.noteApp.createNewNote) {
                        log('âœ… æ‰¾åˆ°å…¨å±€ noteAppï¼Œè°ƒç”¨ createNewNote', 'success');
                        // window.noteApp.createNewNote(); // å…ˆä¸è°ƒç”¨ï¼Œé¿å…é”™è¯¯
                    } else {
                        log('â„¹ï¸ æœªæ‰¾åˆ°å…¨å±€ noteAppï¼Œä½¿ç”¨æ¨¡æ‹Ÿåˆ›å»º', 'info');
                    }
                } else {
                    log('âŒ æŒ‰é’®äº‹ä»¶æœªç»‘å®š', 'error');
                }
            } catch (error) {
                log(`âŒ æ–°å»ºç¬”è®°æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ä¿å­˜åŠŸèƒ½
        function testSave() {
            log('ğŸ’¾ æµ‹è¯•ä¿å­˜åŠŸèƒ½...', 'info');

            try {
                // æ¨¡æ‹Ÿä¿å­˜é€»è¾‘
                const saveData = {
                    title: 'æµ‹è¯•ä¿å­˜æ ‡é¢˜',
                    content: 'æµ‹è¯•ä¿å­˜å†…å®¹',
                    timestamp: new Date().toISOString()
                };

                log(`âœ… æ¨¡æ‹Ÿä¿å­˜æ•°æ®: ${JSON.stringify(saveData, null, 2)}`, 'success');

                if (window.noteApp && window.noteApp.saveCurrentNote) {
                    log('âœ… æ‰¾åˆ°ä¿å­˜æ–¹æ³•', 'success');
                } else {
                    log('â„¹ï¸ æœªæ‰¾åˆ°ä¿å­˜æ–¹æ³•ï¼Œä½¿ç”¨æ¨¡æ‹Ÿä¿å­˜', 'info');
                }
            } catch (error) {
                log(`âŒ ä¿å­˜æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•åˆ é™¤åŠŸèƒ½
        function testDelete() {
            log('ğŸ—‘ï¸ æµ‹è¯•åˆ é™¤åŠŸèƒ½...', 'info');

            try {
                log('âœ… æ¨¡æ‹Ÿåˆ é™¤ç¬”è®°', 'success');

                if (window.noteApp && window.noteApp.deleteCurrentNote) {
                    log('âœ… æ‰¾åˆ°åˆ é™¤æ–¹æ³•', 'success');
                } else {
                    log('â„¹ï¸ æœªæ‰¾åˆ°åˆ é™¤æ–¹æ³•ï¼Œä½¿ç”¨æ¨¡æ‹Ÿåˆ é™¤', 'info');
                }
            } catch (error) {
                log(`âŒ åˆ é™¤æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• DOM äº‹ä»¶
        function testDOMEvents() {
            log('ğŸ¯ æµ‹è¯• DOM äº‹ä»¶...', 'info');

            try {
                // æµ‹è¯•å„ç§äº‹ä»¶
                const events = ['click', 'touchstart', 'touchend', 'mousedown', 'mouseup'];

                events.forEach(eventType => {
                    document.addEventListener(eventType, (e) => {
                        log(`ğŸ“¡ ${eventType} äº‹ä»¶è§¦å‘: ${e.target.tagName}`, 'info');
                    }, { once: true });
                });

                // åˆ›å»ºæµ‹è¯•æŒ‰é’®å¹¶ç‚¹å‡»
                const testBtn = document.createElement('button');
                testBtn.textContent = 'æµ‹è¯•æŒ‰é’®';
                testBtn.onclick = () => log('âœ… æµ‹è¯•æŒ‰é’®ç‚¹å‡»æˆåŠŸ', 'success');
                document.body.appendChild(testBtn);

                setTimeout(() => {
                    testBtn.click();
                    document.body.removeChild(testBtn);
                }, 100);

                log('âœ… DOM äº‹ä»¶æµ‹è¯•è®¾ç½®å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ DOM äº‹ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç§»åŠ¨ç«¯ç‰¹æ€§
        function testMobileFeatures() {
            log('ğŸ“± æµ‹è¯•ç§»åŠ¨ç«¯ç‰¹æ€§...', 'info');

            const features = {
                touchSupport: 'ontouchstart' in window,
                mobileDetect: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                orientation: screen.orientation || window.orientation,
                vibration: 'vibrate' in navigator,
                geolocation: 'geolocation' in navigator,
                camera: 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices
            };

            log(`ç§»åŠ¨ç«¯ç‰¹æ€§: ${JSON.stringify(features, null, 2)}`, 'info');

            if (features.touchSupport) {
                log('âœ… è§¦æ‘¸æ”¯æŒæ­£å¸¸', 'success');
            } else {
                log('â„¹ï¸ æ— è§¦æ‘¸æ”¯æŒ', 'info');
            }
        }

        // æµ‹è¯•è§¦æ‘¸äº‹ä»¶
        function testTouchEvents() {
            log('ğŸ‘† æµ‹è¯•è§¦æ‘¸äº‹ä»¶...', 'info');

            if ('ontouchstart' in window) {
                const testArea = document.createElement('div');
                testArea.style.cssText = 'width: 200px; height: 100px; background: #007bff; color: white; display: flex; align-items: center; justify-content: center; margin: 10px; border-radius: 8px; cursor: pointer;';
                testArea.textContent = 'è§¦æ‘¸æ­¤åŒºåŸŸ';

                testArea.addEventListener('touchstart', (e) => {
                    log(`âœ… è§¦æ‘¸å¼€å§‹: ${e.touches.length} ä¸ªè§¦æ‘¸ç‚¹`, 'success');
                });

                testArea.addEventListener('touchend', (e) => {
                    log('âœ… è§¦æ‘¸ç»“æŸ', 'success');
                });

                document.body.appendChild(testArea);
                log('âœ… è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ', 'success');
            } else {
                log('â„¹ï¸ å½“å‰è®¾å¤‡ä¸æ”¯æŒè§¦æ‘¸äº‹ä»¶', 'info');
            }
        }

        // æµ‹è¯•è§†å£
        function testViewport() {
            log('ğŸ–¼ï¸ æµ‹è¯•è§†å£...', 'info');

            const viewport = {
                width: window.innerWidth,
                height: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio || 1,
                screen: {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight
                }
            };

            log(`è§†å£ä¿¡æ¯: ${JSON.stringify(viewport, null, 2)}`, 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.addEventListener('load', () => {
            log('ğŸš€ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            showSystemInfo();

            // è‡ªåŠ¨å¼€å§‹åŸºç¡€æµ‹è¯•
            setTimeout(() => {
                log('ğŸ” å¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
                testFirebaseConnection();
            }, 1000);
        });

        // é”™è¯¯ç›‘å¬
        window.addEventListener('error', (e) => {
            log(`âŒ JavaScript é”™è¯¯: ${e.error.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        // æœªå¤„ç†çš„ Promise æ‹’ç»
        window.addEventListener('unhandledrejection', (e) => {
            log(`âŒ æœªå¤„ç†çš„ Promise æ‹’ç»: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>